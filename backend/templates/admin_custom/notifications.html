{% extends 'admin_custom/base_admin.html' %}

{% block title %}Notifications - Administration ETE{% endblock %}

{% block page_title %}Notifications{% endblock %}
{% block page_subtitle %}Gérez vos notifications et alertes système{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- En-tête avec statistiques -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
    
    <!-- Non lues -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Non lues</p>
          <p class="text-3xl font-bold text-red-600">{{ notifications.unread_count|default:3 }}</p>
        </div>
        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-bell text-red-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <!-- Aujourd'hui -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Aujourd'hui</p>
          <p class="text-3xl font-bold text-blue-600">{{ notifications.today_count|default:7 }}</p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-calendar-day text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <!-- Cette semaine -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Cette semaine</p>
          <p class="text-3xl font-bold text-green-600">{{ notifications.week_count|default:23 }}</p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-calendar-week text-green-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <!-- Total -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">Total</p>
          <p class="text-3xl font-bold text-gray-800">{{ notifications.total_count|default:156 }}</p>
        </div>
        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-list text-gray-600 text-xl"></i>
        </div>
      </div>
    </div>
    
  </div>

  <!-- Filtres et actions -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0">
      
      <!-- Filtres -->
      <div class="flex flex-wrap items-center space-x-4">
        <select class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
          <option value="">Tous les types</option>
          <option value="collecte">Collectes</option>
          <option value="paiement">Paiements</option>
          <option value="client">Clients</option>
          <option value="agent">Agents</option>
          <option value="systeme">Système</option>
        </select>
        
        <select class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
          <option value="">Toutes les priorités</option>
          <option value="haute">Haute priorité</option>
          <option value="moyenne">Moyenne priorité</option>
          <option value="basse">Basse priorité</option>
        </select>
        
        <select class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary">
          <option value="">Tous les statuts</option>
          <option value="non-lu">Non lues</option>
          <option value="lu">Lues</option>
          <option value="archive">Archivées</option>
        </select>
      </div>
      
      <!-- Actions -->
      <div class="flex items-center space-x-2">
        <button onclick="markAllAsRead()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
          <i class="fas fa-check-double mr-2"></i>
          Tout marquer comme lu
        </button>
        <button onclick="deleteSelected()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
          <i class="fas fa-trash mr-2"></i>
          Supprimer sélectionnées
        </button>
      </div>
      
    </div>
  </div>

  <!-- Liste des notifications -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200">
    
    <!-- En-tête de la liste -->
    <div class="px-6 py-4 border-b border-gray-200">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-900">Toutes les notifications</h3>
        <div class="flex items-center space-x-2">
          <input type="checkbox" id="select-all" class="rounded border-gray-300 text-primary focus:ring-primary">
          <label for="select-all" class="text-sm text-gray-600">Tout sélectionner</label>
        </div>
      </div>
    </div>
    
    <!-- Notifications -->
    <div class="divide-y divide-gray-200">
      
      <!-- Notification 1 - Non lue, Haute priorité -->
      <div class="notification-row bg-red-50 hover:bg-red-100 transition-colors" data-id="1" data-read="false">
        <div class="px-6 py-4">
          <div class="flex items-start space-x-4">
            <input type="checkbox" class="notification-checkbox mt-1 rounded border-gray-300 text-primary focus:ring-primary" value="1">
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  <i class="fas fa-exclamation-triangle mr-1"></i>
                  Haute priorité
                </span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                  Collecte
                </span>
                <span class="text-xs text-gray-500">Il y a 2 heures</span>
              </div>
              
              <h4 class="text-base font-semibold text-gray-900 mb-1">Collecte en retard - Secteur Nord</h4>
              <p class="text-sm text-gray-600 mb-2">
                La tournée programmée pour le secteur Ouaga Nord n'a pas été effectuée dans les délais prévus. 
                Veuillez vérifier le statut de l'équipe assignée et prendre les mesures nécessaires.
              </p>
              
              <div class="flex items-center text-xs text-gray-500 space-x-4">
                <span><i class="fas fa-user mr-1"></i>Agent: Ouédraogo Paul</span>
                <span><i class="fas fa-map-marker-alt mr-1"></i>Zone: Secteur 15</span>
                <span><i class="fas fa-truck mr-1"></i>Véhicule: BF-123-AB</span>
              </div>
            </div>
            
            <div class="flex flex-col items-end space-y-2">
              <div class="w-3 h-3 bg-red-500 rounded-full"></div>
              <button onclick="markAsRead(1)" class="text-primary hover:text-primary-dark text-sm">
                Marquer comme lu
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Notification 2 - Non lue, Moyenne priorité -->
      <div class="notification-row bg-orange-50 hover:bg-orange-100 transition-colors" data-id="2" data-read="false">
        <div class="px-6 py-4">
          <div class="flex items-start space-x-4">
            <input type="checkbox" class="notification-checkbox mt-1 rounded border-gray-300 text-primary focus:ring-primary" value="2">
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  <i class="fas fa-exclamation-circle mr-1"></i>
                  Moyenne priorité
                </span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  Paiement
                </span>
                <span class="text-xs text-gray-500">Il y a 4 heures</span>
              </div>
              
              <h4 class="text-base font-semibold text-gray-900 mb-1">Paiement en attente de validation</h4>
              <p class="text-sm text-gray-600 mb-2">
                La facture #FAC-2024-156 d'un montant de 25,000 FCFA est en attente de validation depuis plus de 48h. 
                Client: Kouadio Marie.
              </p>
              
              <div class="flex items-center text-xs text-gray-500 space-x-4">
                <span><i class="fas fa-credit-card mr-1"></i>Montant: 25,000 FCFA</span>
                <span><i class="fas fa-mobile-alt mr-1"></i>Mobile Money</span>
                <span><i class="fas fa-calendar mr-1"></i>Échéance: Aujourd'hui</span>
              </div>
            </div>
            
            <div class="flex flex-col items-end space-y-2">
              <div class="w-3 h-3 bg-orange-500 rounded-full"></div>
              <button onclick="markAsRead(2)" class="text-primary hover:text-primary-dark text-sm">
                Marquer comme lu
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Notification 3 - Non lue, Basse priorité -->
      <div class="notification-row bg-blue-50 hover:bg-blue-100 transition-colors" data-id="3" data-read="false">
        <div class="px-6 py-4">
          <div class="flex items-start space-x-4">
            <input type="checkbox" class="notification-checkbox mt-1 rounded border-gray-300 text-primary focus:ring-primary" value="3">
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <i class="fas fa-info-circle mr-1"></i>
                  Basse priorité
                </span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  Client
                </span>
                <span class="text-xs text-gray-500">Il y a 6 heures</span>
              </div>
              
              <h4 class="text-base font-semibold text-gray-900 mb-1">Nouveaux clients inscrits</h4>
              <p class="text-sm text-gray-600 mb-2">
                2 nouveaux clients se sont inscrits aujourd'hui: Tapsoba Jean (Secteur 12) et Sawadogo Fatou (Secteur 8). 
                Leurs contrats sont en cours de validation.
              </p>
              
              <div class="flex items-center text-xs text-gray-500 space-x-4">
                <span><i class="fas fa-users mr-1"></i>2 nouveaux clients</span>
                <span><i class="fas fa-file-contract mr-1"></i>Contrats en validation</span>
                <span><i class="fas fa-clock mr-1"></i>Délai: 24h</span>
              </div>
            </div>
            
            <div class="flex flex-col items-end space-y-2">
              <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
              <button onclick="markAsRead(3)" class="text-primary hover:text-primary-dark text-sm">
                Marquer comme lu
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Notification 4 - Lue -->
      <div class="notification-row bg-gray-50 hover:bg-gray-100 transition-colors" data-id="4" data-read="true">
        <div class="px-6 py-4 opacity-75">
          <div class="flex items-start space-x-4">
            <input type="checkbox" class="notification-checkbox mt-1 rounded border-gray-300 text-primary focus:ring-primary" value="4">
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <i class="fas fa-check-circle mr-1"></i>
                  Terminé
                </span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  Collecte
                </span>
                <span class="text-xs text-gray-500">Hier à 16:30</span>
              </div>
              
              <h4 class="text-base font-medium text-gray-700 mb-1">Collecte terminée avec succès</h4>
              <p class="text-sm text-gray-500 mb-2">
                La tournée du secteur Centre a été terminée avec succès. 
                45 collectes ont été effectuées par l'équipe de Traoré Ibrahim.
              </p>
              
              <div class="flex items-center text-xs text-gray-400 space-x-4">
                <span><i class="fas fa-check mr-1"></i>45 collectes</span>
                <span><i class="fas fa-user mr-1"></i>Équipe: Traoré Ibrahim</span>
                <span><i class="fas fa-clock mr-1"></i>Durée: 6h30</span>
              </div>
            </div>
            
            <div class="flex flex-col items-end space-y-2">
              <i class="fas fa-check text-green-500"></i>
              <button onclick="archiveNotification(4)" class="text-gray-500 hover:text-gray-700 text-sm">
                Archiver
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Notification 5 - Lue -->
      <div class="notification-row bg-gray-50 hover:bg-gray-100 transition-colors" data-id="5" data-read="true">
        <div class="px-6 py-4 opacity-75">
          <div class="flex items-start space-x-4">
            <input type="checkbox" class="notification-checkbox mt-1 rounded border-gray-300 text-primary focus:ring-primary" value="5">
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center space-x-2 mb-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  <i class="fas fa-cog mr-1"></i>
                  Système
                </span>
                <span class="text-xs text-gray-500">Hier à 14:15</span>
              </div>
              
              <h4 class="text-base font-medium text-gray-700 mb-1">Mise à jour système</h4>
              <p class="text-sm text-gray-500 mb-2">
                Le système ETE a été mis à jour vers la version 2.1.4. 
                Nouvelles fonctionnalités disponibles dans le module de rapports.
              </p>
              
              <div class="flex items-center text-xs text-gray-400 space-x-4">
                <span><i class="fas fa-code-branch mr-1"></i>Version 2.1.4</span>
                <span><i class="fas fa-download mr-1"></i>Mise à jour automatique</span>
                <span><i class="fas fa-shield-alt mr-1"></i>Sécurisé</span>
              </div>
            </div>
            
            <div class="flex flex-col items-end space-y-2">
              <i class="fas fa-check text-green-500"></i>
              <button onclick="archiveNotification(5)" class="text-gray-500 hover:text-gray-700 text-sm">
                Archiver
              </button>
            </div>
          </div>
        </div>
      </div>
      
    </div>
    
    <!-- Pagination -->
    <div class="px-6 py-4 border-t border-gray-200">
      <div class="flex items-center justify-between">
        <p class="text-sm text-gray-600">
          Affichage de 1 à 5 sur 156 notifications
        </p>
        <div class="flex items-center space-x-2">
          <button class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50" disabled>
            Précédent
          </button>
          <button class="px-3 py-1 bg-primary text-white rounded text-sm">1</button>
          <button class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50">2</button>
          <button class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50">3</button>
          <span class="px-2 text-gray-500">...</span>
          <button class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50">32</button>
          <button class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50">
            Suivant
          </button>
        </div>
      </div>
    </div>
    
  </div>

</div>

<script>
// Gestion des notifications
function markAsRead(id) {
  const row = document.querySelector(`[data-id="${id}"]`);
  if (row) {
    row.setAttribute('data-read', 'true');
    row.classList.remove('bg-red-50', 'bg-orange-50', 'bg-blue-50');
    row.classList.add('bg-gray-50', 'opacity-75');
    
    const dot = row.querySelector('.w-3.h-3');
    if (dot) {
      dot.outerHTML = '<i class="fas fa-check text-green-500"></i>';
    }
    
    const button = row.querySelector('button');
    if (button) {
      button.textContent = 'Archiver';
      button.onclick = () => archiveNotification(id);
    }
  }
}

function markAllAsRead() {
  const unreadRows = document.querySelectorAll('[data-read="false"]');
  unreadRows.forEach(row => {
    const id = row.getAttribute('data-id');
    markAsRead(id);
  });
  
  // Mettre à jour les statistiques
  document.querySelector('.text-red-600').textContent = '0';
}

function archiveNotification(id) {
  const row = document.querySelector(`[data-id="${id}"]`);
  if (row && confirm('Êtes-vous sûr de vouloir archiver cette notification ?')) {
    row.style.transition = 'all 0.3s ease';
    row.style.opacity = '0';
    row.style.transform = 'translateX(100%)';
    
    setTimeout(() => {
      row.remove();
    }, 300);
  }
}

function deleteSelected() {
  const selected = document.querySelectorAll('.notification-checkbox:checked');
  if (selected.length === 0) {
    alert('Veuillez sélectionner au moins une notification à supprimer.');
    return;
  }
  
  if (confirm(`Êtes-vous sûr de vouloir supprimer ${selected.length} notification(s) ?`)) {
    selected.forEach(checkbox => {
      const row = checkbox.closest('.notification-row');
      if (row) {
        row.style.transition = 'all 0.3s ease';
        row.style.opacity = '0';
        row.style.transform = 'translateX(100%)';
        
        setTimeout(() => {
          row.remove();
        }, 300);
      }
    });
  }
}

// Sélection de toutes les notifications
document.getElementById('select-all').addEventListener('change', (e) => {
  const checkboxes = document.querySelectorAll('.notification-checkbox');
  checkboxes.forEach(cb => cb.checked = e.target.checked);
});
</script>

{% endblock %}